# テキサスホールデム ゲームルール仕様書

## 概要
このドキュメントは、FF Pokerで実装するテキサスホールデムの正確なルールを定義します。

## ゲームフロー

### 1. ゲーム開始前
- 最低2人のプレイヤーが必要
- 各プレイヤーはバイイン額のチップを持つ
- ディーラーボタンの位置を決定

### 2. ラウンド開始
1. **ブラインド徴収**
   - ディーラーボタンの左隣: スモールブラインド (SB)
   - SBの左隣: ビッグブラインド (BB)
   - ブラインドは強制ベット

2. **手札配布**
   - 各プレイヤーに2枚のカード(ホールカード)を配る
   - 各プレイヤーは自分のカードのみ見ることができる

### 3. ベッティングラウンド

#### 3.1 プリフロップ
- **最初のアクター**: ビッグブラインドの左隣のプレイヤー (UTG: Under The Gun)
- **アクション順**: 時計回りに進行
- **最後のアクター**: ビッグブラインド
  - BBは誰もレイズしなかった場合でもアクション可能
  - BBが「チェック」すると次のストリートへ

#### 3.2 フロップ以降 (フロップ/ターン/リバー)
- **最初のアクター**: スモールブラインド(またはフォールドしている場合は次の有効プレイヤー)
- **アクション順**: 時計回りに進行

### 4. 利用可能なアクション

#### フォールド (Fold)
- ゲームから降りる
- ベットしたチップは取り戻せない
- いつでも実行可能

#### チェック (Check)
- 追加ベットせずにパス
- **実行可能条件**:
  - 現在のベット額 == 自分のベット額
  - つまり、誰もベットしていない、または既にコールしている状態

#### コール (Call)
- 現在のベット額に合わせる
- **必要額**: (現在の最大ベット額) - (自分のベット額)
- チップが足りない場合は全額ベット(オールイン)

#### ベット/レイズ (Bet/Raise)
- **ベット**: 誰もベットしていない状態で賭ける
- **レイズ**: 既存のベットを上乗せする
- **最小額**:
  - ベット: ビッグブラインド以上
  - レイズ: 直前のレイズ額以上を上乗せ
    - 例: BBが10、プレイヤーAが30にレイズ(+20)した場合、次のレイズは最低50(+20)
- チップが足りない場合は全額ベット(オールイン)

#### オールイン (All-in)
- 残り全チップをベット
- それ以上アクションできない
- サイドポットが発生する可能性あり

### 5. ベッティングラウンド完了条件

以下の**すべて**を満たす必要がある:

1. **全員がアクション済み**
   - フォールドしていない全プレイヤーが最低1回アクションした
   - プリフロップではBBが最後にアクション権を持つ

2. **ベット額が揃っている**
   - アクティブな全プレイヤーのベット額が同じ
   - ただし、オールインしたプレイヤーは除外

3. **レイズがない、またはレイズに全員が対応した**
   - 最後のレイズ/ベット後、全員がコール/フォールド/オールインした

### 6. ストリート進行

#### フロップ
- コミュニティカード3枚をオープン
- ベッティングラウンド

#### ターン
- コミュニティカード1枚追加(合計4枚)
- ベッティングラウンド

#### リバー
- コミュニティカード1枚追加(合計5枚)
- ベッティングラウンド

### 7. ショーダウン
- リバーのベッティング完了後
- 残っているプレイヤーが手札を公開
- 最も強い役を持つプレイヤーが勝利
- 同じ強さの場合は分配

### 8. ポット分配

#### メインポット
- 全プレイヤーが参加できるポット

#### サイドポット
- オールインしたプレイヤーがいる場合に発生
- オールイン額を超える分のベットは別ポット
- そのポットに参加したプレイヤーのみが獲得権利を持つ

**例**:
- プレイヤーA: 100チップでオールイン
- プレイヤーB: 200チップベット
- プレイヤーC: 200チップコール

**ポット構成**:
- メインポット: 300チップ (A, B, C が各100) → A, B, C が争う
- サイドポット: 200チップ (B, C が各100) → B, C のみが争う

### 9. ラウンド終了
- 勝者にポットを分配
- チップが0になったプレイヤーは除外
- ディーラーボタンを次のプレイヤーへ移動
- 2人以上残っていれば次のラウンド開始

## 重要な実装ポイント

### ターン管理
- 現在のアクタープレイヤーを明確に追跡
- アクション権はそのプレイヤーのみ
- 不正なアクションは即座にエラー

### 状態検証
- 各アクション前に実行可能性をチェック
- チェック: 追加ベット不要な状態のみ
- コール: ベットがある状態のみ
- レイズ: 最小額以上

### ベッティング完了判定
- 「全員アクション済み」かつ「ベット額が揃っている」
- プリフロップは特別: BBが最後にアクション
- オールインプレイヤーは判定から除外

### エッジケース
- 全員フォールド → 最後のプレイヤーが勝利
- 1人以外全員オールイン → ベッティング完了、次のストリートへ
- 最初のアクションでチェック可能かどうか(ブラインドがある場合など)

## テストケース例

### ケース1: 基本的なプリフロップ
1. BBの次のプレイヤーが最初にアクション
2. 全員コールまたはフォールド
3. BBが最後にチェック可能
4. BBがチェックでフロップへ

### ケース2: レイズがある場合
1. プレイヤーAがレイズ
2. レイズ後の全員がコール/フォールド/リレイズ
3. 最後のレイザーまで回ったら完了

### ケース3: オールイン
1. プレイヤーAがオールイン
2. 他のプレイヤーがコール/フォールド
3. オールインプレイヤーはそれ以上アクションしない

### ケース4: サイドポット
1. 複数のオールインで異なる額
2. メインポットとサイドポットを正確に計算
3. 各ポットの勝者を個別に決定
